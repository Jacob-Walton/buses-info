@page "/admin"
@model BusInfo.Pages.Admin.IndexModel
@{
ViewData["Title"] = "Admin Dashboard";
}

<div class="admin-layout">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <nav class="admin-nav">
            <div class="admin-nav__section">
                <h3 class="admin-nav__section-title">Main</h3>
                <div class="admin-nav__item">
                    <a href="/admin" class="active">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </div>
                <div class="admin-nav__item">
                    <a href="/admin/users">
                        <i class="fas fa-users"></i>
                        <span>Users</span>
                    </a>
                </div>
            </div>

            <div class="admin-nav__section">
                <h3 class="admin-nav__section-title">API</h3>
                <div class="admin-nav__item">
                    <a href="/admin/apimanagement">
                        <i class="fas fa-key"></i>
                        <span>API Management</span>
                    </a>
                </div>
                <div class="admin-nav__item">
                    <a href="/admin/api-requests">
                        <i class="fas fa-paper-plane"></i>
                        <span>API Requests</span>
                    </a>
                </div>
                <div class="admin-nav__item">
                    <a href="/admin/analytics">
                        <i class="fas fa-chart-bar"></i>
                        <span>Analytics</span>
                    </a>
                </div>
            </div>

            <div class="admin-nav__section">
                <h3 class="admin-nav__section-title">System</h3>
                <div class="admin-nav__item">
                    <a href="/admin/settings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
                <div class="admin-nav__item">
                    <a href="/admin/logs">
                        <i class="fas fa-list"></i>
                        <span>Logs</span>
                    </a>
                </div>
                <div class="admin-nav__item">
                    <a href="/admin/health">
                        <i class="fas fa-heartbeat"></i>
                        <span>System Health</span>
                    </a>
                </div>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-content">
        <header class="admin-header">
            <div class="admin-header__title">
                <h1>
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </h1>
                <div class="breadcrumb">
                    <a href="/admin">Admin</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>Dashboard</span>
                </div>
            </div>

            <div class="admin-header__actions">
                <button id="refreshMetricsButton" class="admin-btn admin-btn--outline">
                    <i class="fas fa-sync-alt"></i>
                    <span>Refresh</span>
                </button>
            </div>
        </header>

        <!-- Metrics Overview -->
        <div id="adminMetrics" class="admin-overview">
            <div class="admin-metric-card">
                <div class="admin-metric-card__icon admin-metric-card__icon--primary">
                    <i class="fas fa-users"></i>
                </div>
                <div class="admin-metric-card__content">
                    <div id="totalUsers" class="metric-value">@Model.Metrics.TotalUsers</div>
                    <div class="metric-label">Total Users</div>
                </div>
            </div>

            <div class="admin-metric-card">
                <div class="admin-metric-card__icon admin-metric-card__icon--secondary">
                    <i class="fas fa-key"></i>
                </div>
                <div class="admin-metric-card__content">
                    <div id="activeApiKeys" class="metric-value">@Model.Metrics.ActiveApiKeys</div>
                    <div class="metric-label">Active API Keys</div>
                </div>
            </div>

            <div class="admin-metric-card">
                <div class="admin-metric-card__icon admin-metric-card__icon--success">
                    <i class="fas fa-signal"></i>
                </div>
                <div class="admin-metric-card__content">
                    <div id="apiRequests" class="metric-value">@Model.Metrics.ApiRequests24Hours.ToString("N0")</div>
                    <div class="metric-label">API Requests (24h)</div>
                </div>
            </div>

            <div class="admin-metric-card">
                <div class="admin-metric-card__icon admin-metric-card__icon--info">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="admin-metric-card__content">
                    <div id="avgResponseTime" class="metric-value">@Model.Metrics.AverageResponseTime.ToString("0.0") ms
                    </div>
                    <div class="metric-label">Avg Response Time</div>
                </div>
            </div>
        </div>
        <!-- System Health -->
        <div class="admin-card">
            <div class="admin-card__header">
                <h3 class="admin-card__title">
                    <i class="fas fa-heartbeat"></i>
                    System Health
                </h3>
            </div>
            <div class="admin-card__body">
                <div class="admin-service-grid">
                    @foreach (var service in Model.SystemHealth.Services)
                    {
                    <div class="service-item">
                        <i class="fas @GetServiceIcon(service.Key) service-icon"></i>
                        <div class="service-name">@service.Key</div>
                        <div class="service-status @service.Value.ToString().ToLower()"></div>
                    </div>
                    }
                </div>
            </div>
        </div>
        <!-- Main Sections -->
        <div class="admin-sections">
            <!-- Recent Activity -->
            <div class="admin-section">
                <div class="admin-section__header">
                    <h2 class="admin-section__title">Recent Activity</h2>
                </div>
                <div class="admin-section__content">
                    @if (Model.RecentActivity?.Count > 0)
                    {
                    <div class="admin-activity__list">
                        @foreach (var activity in Model.RecentActivity)
                        {
                        <div class="admin-activity__item">
                            <div class="admin-activity__icon admin-activity__icon--@activity.Type.ToLower()">
                                <i class="fas fa-@activity.Icon"></i>
                            </div>
                            <div class="admin-activity__content">
                                <p class="activity-message">@Html.Raw(activity.Description)</p>
                                <div class="activity-meta">
                                    <div class="activity-time">
                                        <i class="fas fa-clock"></i>
                                        <span>@activity.TimeAgo</span>
                                    </div>
                                    @if (!string.IsNullOrEmpty(activity.AdminId))
                                    {
                                    <div class="activity-user">
                                        <i class="fas fa-user"></i>
                                        <span>@activity.AdminEmail</span>
                                    </div>
                                    }
                                </div>
                            </div>
                        </div>
                        }
                    </div>
                    }
                    else
                    {
                    <div class="admin-section__empty">
                        <p>No recent activity found</p>
                    </div>
                    }
                </div>
            </div>

            <!-- Pending API Requests -->
            <div class="admin-section">
                <div class="admin-section__header">
                    <h2 class="admin-section__title">Pending API Requests</h2>
                </div>
                <div class="admin-section__content">
                    @if (Model.PendingRequests?.Count > 0)
                    {
                    <div class="admin-table-wrapper">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Requested</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var request in Model.PendingRequests)
                                {
                                <tr>
                                    <td>@request.UserEmail</td>
                                    <td>@request.RequestedTimeAgo</td>
                                    <td class="actions">
                                        <a href="/admin/apimanagement?requestId=@request.Id"
                                            class="admin-btn admin-btn--primary admin-btn--sm">
                                            <i class="fas fa-eye"></i>
                                            <span>View</span>
                                        </a>
                                    </td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    }
                    else
                    {
                    <div class="admin-section__empty">
                        <p>No pending API requests</p>
                    </div>
                    }
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Mobile sidebar toggle -->
<button class="admin-sidebar-toggle">
    <i class="fas fa-bars"></i>
</button>

@section Scripts {
<script src="~/js/admin/dashboard.js" asp-append-version="true"></script>
}

@functions {
string GetServiceIcon(string serviceName)
{
return serviceName.ToLower() switch
{
"database" => "fa-database",
"api" => "fa-server",
"cache" => "fa-memory",
"email" => "fa-envelope",
_ => "fa-cog"
};
}
}

@section Head {
<link rel="stylesheet" cdn href="/css/admin/admin.css" />
}